<!DOCTYPE html>
<html manifest="site.appcache">

<head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Offsite 2013 : " />

     <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/offsite.css">     
    <script src="javascripts/offsite.js"></script>
    <script src="javascripts/main.js"></script>
    <title>Offsite 2013</title>
</head>

<body ng-app ng-controller="GameController" ng-init="init()">

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
            <!-- <a id="forkme_banner" href="https://github.com/josephaanthony">View on GitHub</a> -->

            <h1 id="project_title">Offsite 2013</h1>
            <h2 id="project_tagline"></h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
        <section id="main_content" class="inner">
            <h3>
                <a name="welcome-to-offsite-2013" class="anchor" href="#welcome-to-offsite-2013"><span class="octicon octicon-link"></span></a>Welcome to Offsite 2013.</h3>

            <p>This automatic page generator is the easiest way to create beautiful pages for all of your projects. Author your page content here using GitHub Flavored Markdown, select a template crafted by a designer, and publish. After your page is generated, you can check out the new branch:</p>
        </section>
    </div>

    <input type="button" onclick="localStorage.clear()" value="Clear" />
    <div style="background-color:#0094ff" ng-hide="pagetext">        
        Please enter the passcode : 
        <input id="password1" ng-model="passCode" type="password"/>
        <input type="submit" value="Enter The Hunt" ng-click="decryptGame(passCode)" />
    </div>

    <div style="width:100%" ng-show="pagetext">
        <div style="background-color:#808080; color:#fff; float:left; width:50%">
            {{pagetext.clueText}}
            <!--<select ng-model="pagetext.selectedOption" ng-options="c as c.clueNo for c in pagetext.clueOptions" ng-change="resetForNextClue()"></select>-->
            <select ng-model="pagetext.selectedOption" ng-options="k as k for (k,v) in pagetext.clueOptions" ng-change="resetForNextClue()"></select>
<!--            <select ng-model="pagetext.selectedOption" ng-change="resetForNextClue()">
                <option ng-repeat="(k,v) in pagetext.clueOptions" value="{{k}}">                
                    {{k}} - {{ pagetext.selectedOption == k }}
                </option>
            </select>-->
            <div>
                {{pagetext.clueOptions[pagetext.selectedOption].clue}}
            </div>
            <div ng-show="pagetext.selectedOption">
                Your Answer Here: <input type="text" ng-model="pagetext.currentAnswer" />
                <input type="submit" value="Validate Answer" ng-click="validateAnswer(pagetext.currentAnswer)" />
            </div>

            <div ng-show="pagetext.nextClue">
                {{pagetext.submitMessage}}
            </div>
        </div>

        <div style="background-color:#ffd800; color:#fff; float:right; width:50%">
            Status: {{pagetext.clueOptionsAnswered.length}}
            <div ng-repeat="(clueNo, opt) in pagetext.clueOptionsAnswered">
                {{clueNo}} - {{opt.answer}}
            </div>
        </div>
    </div>

<!--    <div>
        <div class="control-group">
            <label class="control-label" for="password">Password</label>
            <div class="controls">
                <input id="password" type="password"/>
            </div>
        </div>
    
        <div class="control-group">
            <label class="control-label" for="text" id="text-label">Text</label>
            <div class="controls">
                <input id="text" type="text"/>
            </div>
        </div>
    
        <div class="control-group">
            <label class="control-label" for="encrypt" id="encrypt-label">Encrypt</label>
            <div class="controls">
                <input id="encrypt" type="text"/>
            </div>
        </div>
    </div>-->




    <script>
        function GameController($scope) {
            $scope.passCode = null;

            $scope.data = "0xL5/Uq154MJyQR9knTBOS4n7O3NTdBTfYYKx75/YjlP4AX5g4Wjd96wHNnwPAgq4cvvRQm7MVA/4/tD1z5BFw+KGmElECrFbgA+FdkbI7cyEJvoVtw2HFhH6ULe1u3H4mZCoIHVNUFDEYV3vEdMTnyhhOgCL4JpN+1R4UwlQFsitOQb8eK3lwcj9CSGLFS4AhoRoGvn0w7vdaaj0Ws+AEoSPxNoInRWansViSPY5/myop4WS9n7jLfxTwgjJQLFO7zxb5GsVI6JKzPoLnR+3iiYB8nYqIttuBbWVXn2Yyjwr9YWH1MC6FF81+m7rGdtz5CP+0ifzIQFCsg11zkPSITH8OK9HgHREf/UhTIxqt1ZAzyPSA4vW9Y22c/9W1hSLyIkgISe29036jy11dDv28ua37+Uao1+/VvBx6F8cAGc1n0K7AYzSpDCTEXD/ODezeDbws19ODhTxlle9Vh4mQla5vGhsr5KDgEVmhkwk+E9uWLE+MJJq7mPqryu9rrd5glKFZChzhcKHNxCA+YCH0XCKHFIe7aNvJ4RF1+7rsT4LlDOxauOtGr27gZ4iHFG6PIwHlpah+b5ZQYELT1l8+L6HZgfIedRv1ifGAw2zObsnP0MBRM9xe+Yu+6wX/kzgeE+pJbSLgCYHbUKav+0oR0Ei/jU8FZR9ECgpvi/cKbMPT3G/nQUDJ+2pFZI1straclEyfe6b1P/UBYE7K/z4LznYFLvETUTU27wO5jequnDWOGUqG93dMtgO/DWvHJowrRNAnnvP1ucx5bOMrAwPbmzipAuo0/AH9YMEEtwhBI67KZ+rT1/Ot6B4xbDOUPjQiFiyQeX5A+Jz6A4sdtn3TWn/UM3wgzZlrBsG0yhdDqNhzNjLzNhvLIEyNJWH/q12LYEvgFyZQMbOIWWRl4QUxWp+vrKcuiZPk8I4tl67GXmzI55M3qSb9epCP3fVwq7RHwTFdKsu2pz2C/oEiFnIlq2C1NftwTDoAEVK/UMgPmQdiXau+I5k/D8n1ofhrdaLI6v/CwIyVwKL8sK2W6XU56zzd1D6PW5if91gIEe+NM1kxCFbXzxXfqMcCTpxHf6I0IJFRGahfR4F46jW5dJEp2ioe3cvZ5/jrjrNLyAuk+JmA+u2+zeQOBy7AW63Rv9AZtjs8LStgDb8HFLIiPSxUuzP4Y1724zDSzMS07fYYx6G2xDX3+nwbIqlRH2I+561XH+fcXv1S5Rau/do7H6E9lXV4vwEK9eO1bsfRsZbKZgLg18k0hoyczwk4P8fvJASSbq9uqis8U4ra7UDxwBzgJsys3wWk6FERwCFMc6ShdFLs8LqLCgqq7PrVLejC+xLsc9sB14Fbm2R/12OVxz1yKiZa43Bj7rgiNoop/MTdRw8VV1rKO7hNu1B5dtXIPzglcf9xJVYjtbpW4HVzNVE+dPmYYPIZzHOG+POQxmhyKTXVWQzdfWKxkKowjQ4jqIk96Lkhi6gGY4bmOzUBjGivhun522+6v8dP6YlI3ljvDe0nNS";

            $scope.pagetext = null;

            //$scope.pagetext = {
            //    clueText: 'Select Your Next Clue',
            //    clueOptions: {
            //        1: { clueNo: "1", clue: "What is your name1", answer: "NqGSqFQbYknzBQka3T0bLJ1Q1Xs=" },
            //        2: { clueNo: "2", clue: "What is your name2", answer: "58N/Lkt+ZPvrtzUp7MmaZ2O+QFM=" },
            //        3: { clueNo: "3", clue: "What is your name3", answer: "L347CupDNcmjBlwsbmtrXbz8EmQ=" },
            //        4: { clueNo: "4", clue: "What is your name4", answer: "BVWomzU1UMGs9+4AFZlBpapQPFw=" },
            //        5: { clueNo: "5", clue: "What is your name5", answer: "lg5FDfbXAq9apuxuNHthfThUPnE=" },
            //        6: { clueNo: "6", clue: "What is your name6", answer: "MxBdWxSAFEqhbZ924e592CWkgpA=" },
            //    },
            //    selectedOption: null,
            //    clueOptionsAnswered: {},
            //    successMessage: "Congratulations! Your answer is correct. Please select your next clue.",
            //    errorMessage: "Sorry! Your answer is incorrect. Please try again.",
            //    nextClue: false,
            //    currentAnswer: null,
            //    submitMessage: null
            //};

            $scope.init = function () {
                var passCode = Util.getFromLocalStorage("STORE-passCode");
                if (passCode != null) {
                    $scope.decryptGame(passCode);
                    $scope.pagetext.selectedOption = Util.getFromLocalStorage("STORE-selectedOptionClueNo");
                    $scope.pagetext.clueOptionsAnswered = Util.getFromLocalStorage("STORE-clueOptionsAnswered");
                }
                else if($scope.pagetext) {
                    //$scope.pagetext.selectedOption = $scope.pagetext.clueOptions[Util.getFromLocalStorage("STORE-selectedOptionClueNo")];
                    $scope.pagetext.selectedOption = Util.getFromLocalStorage("STORE-selectedOptionClueNo");
                    $scope.pagetext.clueOptionsAnswered = Util.getFromLocalStorage("STORE-clueOptionsAnswered");
                }

                if ($scope.pagetext && !$scope.pagetext.clueOptionsAnswered) {
                    $scope.pagetext.clueOptionsAnswered = {};
                }
            }

            $scope.resetForNextClue = function () {
                $scope.pagetext.currentAnswer = null;
                $scope.pagetext.nextClue = false;
                Util.setToLocalStorage("STORE-selectedOptionClueNo", $scope.pagetext.selectedOption);
            }

            $scope.validateAnswer = function (answer)
            {
                var selectedClue = $scope.pagetext.clueOptions[$scope.pagetext.selectedOption];

                var deAnswer = Tea.decrypt(selectedClue.answer, answer);

                if (selectedClue.clue == deAnswer) {
                    $scope.pagetext.clueOptionsAnswered[$scope.pagetext.selectedOption] = { answer: answer, selectedOption: $scope.pagetext.selectedOption };
                    $scope.pagetext.selectedOption = null;
                    $scope.pagetext.submitMessage = $scope.pagetext.successMessage;

                    Util.setToLocalStorage("STORE-clueOptionsAnswered", $scope.pagetext.clueOptionsAnswered);
                    Util.setToLocalStorage("STORE-selectedOptionClueNo", $scope.pagetext.selectedOption);
                }
                else
                {
                    $scope.pagetext.submitMessage = $scope.pagetext.errorMessage;
                }
                $scope.pagetext.nextClue = true;
            }

            $scope.decryptGame = function (passCode)
            {
                var gameJSON = null;
                try {
                    gameJSON = eval("(" + Tea.decrypt($scope.data, passCode) + ")");
                }
                catch (e) {
                    alert("Invalid Hunt Code! Please try again.");
                    return;
                }

                $scope.pagetext = gameJSON;
                Util.setToLocalStorage("STORE-passCode", passCode);
            }
        }


        var Util = new function () {
            this.setToLocalStorage = function(key, item) {
                localStorage.setItem(key, JSON.stringify(item));
            }

            this.getFromLocalStorage = function(key) {
                return JSON.parse(localStorage.getItem(key));
            }
        }

        var password = $('#password'),
        text = $('#text'),
        enc = $('#encrypt')
        , encrypt = function () {
            enc.val(Tea.encrypt(text.val(), password.val()))
        }, decrypt = function () {
            text.val(Tea.decrypt(enc.val(), password.val()))
        };
        $('#text-label').click(decrypt)
        $('#encrypt-label').click(encrypt)
        text.on('blur', encrypt)
        enc.on('blur', decrypt);
    </script>
</body>
</html>
